<form class="login-form" action="<?php echo $PATH ;?>/controllers/user/write.php" accept-charset="UTF-8" method="post" enctype="multipart/form-data">

  <select multiple="multiple" id="recipient_emails" name="recipient_emails[]" class="contacts" placeholder="Alıcılar..."></select>

  <input type="text" placeholder="Konu" class="form-control" size="50" name="subject" id="subject" />

  <textarea class="form-control" rows="10" name="content" id="content">
  </textarea>

  <div id="file-new"></div>

  <button type="submit" class="btn btn-primary">Gönder</button>
  <button type="button" class="btn btn-default" id="file-add">Dosya Ekle</button>
</form> 
<script>
$("#file-add").click(function() {
	$("#file-new").append("<input type='file' id='files' name='files[]' multiple class='form-control'/>");
});
</script>
<?php

$_user_result = mysql_query("select * from Users");
while ($row = mysql_fetch_assoc($_user_result))
	$_users[] = array(
				"email" => $row['email'],
				"name" => $row['first_name'] . " " . $row['last_name']
			);
?>
<script>
var REGEX_EMAIL = '([a-z0-9!#$%&\'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+/=?^_`{|}~-]+)*@' +
                  '(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)';

$('#recipient_emails').selectize({
    persist: false,
    maxItems: null,
    valueField: 'email',
    labelField: 'name',
    searchField: ['name', 'email'],
    options: <?php echo json_encode($_users); ?>,
    render: {
        item: function(item, escape) {
            return '<div>' +
                (item.name ? '<span class="name">' + escape(item.name) + '</span>' : '') +
                (item.email ? '<span class="email">' + escape(item.email) + '</span>' : '') +
            '</div>';
        },
        option: function(item, escape) {
            var label = item.name || item.email;
            var caption = item.name ? item.email : null;
            return '<div>' +
                '<span class="label">' + escape(label) + '</span>' +
                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
            '</div>';
        }
    },
    createFilter: function(input) {
        var match, regex;

        // email@address.com
        regex = new RegExp('^' + REGEX_EMAIL + '$', 'i');
        match = input.match(regex);
        if (match) return !this.options.hasOwnProperty(match[0]);

        // name <email@address.com>
        regex = new RegExp('^([^<]*)\<' + REGEX_EMAIL + '\>$', 'i');
        match = input.match(regex);
        if (match) return !this.options.hasOwnProperty(match[2]);

        return false;
    },
    create: function(input) {
        if ((new RegExp('^' + REGEX_EMAIL + '$', 'i')).test(input)) {
            return {email: input};
        }
        var match = input.match(new RegExp('^([^<]*)\<' + REGEX_EMAIL + '\>$', 'i'));
        if (match) {
            return {
                email : match[2],
                name  : $.trim(match[1])
            };
        }
        alert('Invalid email address.');
        return false;
    }
});
</script>
